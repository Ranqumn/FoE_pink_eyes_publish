%----------------------------------------------------------------------------------------
%	宏包设置
%----------------------------------------------------------------------------------------


% 浮动体

\usepackage{graphicx} % 插图
\graphicspath{{image/}} % 图片目录

% \usepackage[section]{placeins} % 防止浮动体跨区 NOTE: 用 float 来实现
\usepackage{float} % 用来钉死浮动体

% --------

% 排版专用

\usepackage{nag} % 检查过时指令

% \usepackage[english]{babel}
\usepackage{microtype} % 微排版

\usepackage{calc} % 版心计算

% \usepackage{layout} % 查看版面设计

% 页眉样式

\usepackage{fancyhdr}

\fancypagestyle{chinese}{%
\fancyhf{} % 清空

\fancyhead[LE,RO]{\thepage}

\fancyhead[LO]{\sffamily {\leftmark}} % 奇数页  \leftmark = 章节名称
\fancyhead[RE]{\sffamily {辐射小马国：粉色双眸}} % 偶数页
}

\fancypagestyle{english}{%
\fancyhf{} % 清空

\fancyhead[LE,RO]{\thepage}

\fancyhead[LO]{\sffamily {\leftmark}} % 奇数页  \leftmark = 章节名称
\fancyhead[RE]{\sffamily \uppercase{Fallout Equestria: Pink Eyes}} % 偶数页
}


% 重新制作适应 B5 的版心 具体在 main 中的开头
% 
% 资料：
% - [Type is Beautiful    » 从「行长为字号的整数倍」说起](https://thetype.com/2017/07/12513/)
% - [中文排版时，每行文字最优的个数是多少？ - 知乎](https://www.zhihu.com/question/19621078)
% - [ctexart页面宽度不到1/2 · Issue #386 · CTeX-org/ctex-kit · GitHub](https://github.com/CTeX-org/ctex-kit/issues/386)


\newcommand{\englinespread}{\linespread{1.1} \selectfont}


\usepackage[bodytextleadingratio=1.5]{zhlineskip} % 正文行高修正

% 设置西文段落行距
% 参考：
% - [zhlineskip: 增加范例，单独设置西文段落的行距 · Issue #425 · CTeX-org/ctex-kit · GitHub](https://github.com/CTeX-org/ctex-kit/issues/425)
% - zhlineskip 宏包手册

\newenvironment{englishpar}  % 新建「英文段落」环境
{\addvspace\medskipamount}  % 段前间距，上文段落需结束
{\par\addvspace\medskipamount} % 段后间距

\newenvironment{englishlyric}{}{}  % 新建「英文歌词」环境


% zhlineskip 宏包命令
% \SetTextEnvironmentSinglespace{1.1} % 根据需要修改此数，默认值是 1，适合西文「单倍」行距

\RestoreTextEnvironmentLeading{englishpar}
\RestoreTextEnvironmentLeading{englishlyric}


% \usepackage{scrextend} 
% % 修改脚注样式
% \deffootnote[1.5em]{1.5em}{1em}{〔\thefootnotemark〕\space}
% \deffootnotemark{\textsuperscript{〔\thefootnotemark〕}}
% NOTE: 还要调整基线


%----------------------------------------------------------------------------------------
%	Input and Fonts
%----------------------------------------------------------------------------------------

% 使用 XeLaTeX 
\usepackage{xltxtra,xunicode}

\usepackage{textcomp} % 扩展特殊字符

\defaultfontfeatures{Ligatures=TeX} % fontspec 使用 TeX 的语法打特殊字符

% 使用 Noto CJK


\newfontfamily\raintree{Raintree}[Scale=1.1] % 英文发布版带字体 注意版权问题

\newfontfamily\awesomefont{Font Awesome 5 Free Solid}[Scale=1.1]

\setmainfont{lmroman10-regular.otf}[
  ItalicFont=lmroman10-italic.otf,
  BoldFont=lmroman10-bold.otf,
  BoldItalicFont=lmroman10-italic.otf,
  SmallCapsFont=lmromancaps10-regular.otf,
  SlantedFont=lmromanslant10-regular.otf,
  Scale=1.1
]

\setsansfont{lmsans10-regular.otf}[
  ItalicFont=lmsans10-oblique.otf,
  BoldFont=lmsans10-bold.otf,
  BoldItalicFont=lmsans10-boldoblique.otf,
  Scale=1.1
]

\setmonofont{lmmono10-regular.otf}[
  ItalicFont=lmmono10-italic.otf,
  SmallCapsFont=lmmonocaps10-regular.otf,
  Scale=1.1
]

\setCJKmainfont{Noto Serif CJK SC}[
  BoldFont=Noto Serif CJK SC Bold,
  ItalicFont=FandolKai-Regular
]

\setCJKsansfont{Noto Sans CJK SC DemiLight}[
  BoldFont=Noto Sans CJK SC Medium
]


% 暴力修正 FandolKai Fandol-FangSong 的基线
% via: https://github.com/clerkma/ptex-ng-dist/issues/5

\makeatletter
\newcommand*\original@CJKsymbol{}
\newcommand*\original@CJKpunctsymbol{}
\let\original@CJKsymbol\CJKsymbol
\let\original@CJKpunctsymbol\CJKpunctsymbol
\newcommand*\raise@Fandol@CJK[1]{\raise0.08\ccwd\hbox{#1}}
\appto\itshape{%
  \let\CJKsymbol\raise@Fandol@CJK
  \let\CJKpunctsymbol\raise@Fandol@CJK
}
\appto\kaishu{%
  \let\CJKsymbol\raise@Fandol@CJK
  \let\CJKpunctsymbol\raise@Fandol@CJK
}
\appto\fangsong{%
  \let\CJKsymbol\raise@Fandol@CJK
  \let\CJKpunctsymbol\raise@Fandol@CJK
}
\appto\upshape{%
  \let\CJKsymbol\original@CJKsymbol
  \let\CJKpunctsymbol\original@CJKpunctsymbol
}
\makeatother

%----------------------------------------------------------------------------------------
% 标记的样式设定
%----------------------------------------------------------------------------------------

\newcommand{\mt}{\raintree \fangsong} % mt -> mechinetalk NOTE: 另外一种样式

\newcommand{\rt}{\sffamily} % rt -> radiotalk
\newcommand{\py}{\sffamily} % py -> 怕音

\newcommand{\mtpr}[1]{{\mt #1}} % mtpr -> mechinetalk prefix
\newcommand{\rtpr}[1]{{\rt #1}} % rtpr -> radiotalk prefix
\newcommand{\pypr}[1]{{\py #1}} % pypr -> py prefix
\newcommand{\rcpr}[1]{\emph{#1}} % 回忆 mrpr -> recall prefix
\newcommand{\thpr}[1]{\emph{#1}} % 心理活动 thpr -> thought prefix
\newcommand{\stpr}[1]{{\itshape \CJKunderdot{#1}}} % 强调 st -> stress % 不使用粗体 使用加点
\newcommand{\rspr}[1]{\emph{#1}} % 录音声音 rspr -> record sound
\newcommand{\wrpr}[1]{{\itshape #1}} % 书写 wr -> write 

%----------------------------------------------------------------------------------------
%	数学相关
%----------------------------------------------------------------------------------------

\usepackage{amsmath,amssymb,amsthm}
\usepackage{siunitx}


%----------------------------------------------------------------------------------------
%	目录
%----------------------------------------------------------------------------------------

\setcounter{secnumdepth}{0} % 取消节编号

%----------------------------------------------------------------------------------------
%	LINKS
%----------------------------------------------------------------------------------------

\usepackage{url}

% 强制 URL 换行 via: https://tex.stackexchange.com/questions/3033/forcing-linebreaks-in-url

\expandafter\def\expandafter\UrlBreaks\expandafter{\UrlBreaks%  save the current one
  \do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j%
  \do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t%
  \do\u\do\v\do\w\do\x\do\y\do\z\do\A\do\B\do\C\do\D%
  \do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N%
  \do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X%
  \do\Y\do\Z}



\usepackage[xetex]{hyperref}

\hypersetup{breaklinks=true,
            pdfauthor={RandomQuantum},
            pdftitle={Fallout Equestria: Pink Eyes 辐射小马国：粉色双眸},
            pdfcreator={LaTeX with CTeX and hyperref},
            pdfkeywords={FoE}
            }
%----------------------------------------------------------------------------------------
%	环境
%----------------------------------------------------------------------------------------

% 题记样式
\newenvironment{intro}{\begin{center}\slshape \kaishu}
{\end{center}\medskip}

% \newenvironment{song}{\begin{flushright}\itshape \kaishu {\awesomefont  \quad}}{\end{flushright}}

% 唱歌样式
\newenvironment{song}{\begin{flushright}\itshape \kaishu}{\end{flushright}}

% 音乐样式
\newenvironment{music}{\begin{flushright}\itshape \kaishu {\awesomefont  }\hspace{\fill}}{\end{flushright}}

% \newenvironment{song}{\begin{flushright}\itshape \kaishu \marginpar[]{ \awesomefont }}{\end{flushright}}

% \newenvironment{song}{\marginpar[]{ \awesomefont }\begin{flushright}\itshape \kaishu}{\end{flushright}}


\newcommand\daytimeplace[4]{
  \begin{table}[H]
    \centering \ttfamily
    第 #1 天

    大约时间：#2

    地点：#3

    \textsc{Loaction}: #4
  \end{table}
}

\newcommand\unknowndaytimeplace{
  \begin{table}[H]
    \centering \ttfamily
    日期：N/A

    时间：N/A
    
    地点：N/A
  \end{table}
}

\newcommand\englishdaytimeplace[3]{
  \begin{table}[H]
    \centering \ttfamily
    \textsc{Day} #1

    \textsc{Time} approximately #2

    \textsc{Loaction}: #3
  \end{table}
}

\newcommand\englishunknowndaytimeplace{
  \begin{table}[H] % 钉死
    \centering
    \begin{tabular}{lr}
      \texttt{\textsc{Day}} & \texttt{N.A.} \\
      \texttt{\textsc{Time}} & \texttt{N.A.} \\
      \texttt{\textsc{Loaction}} & \texttt{N.A.} \\
    \end{tabular}    
  \end{table}
}

\font\eightssi=cmssqi8

\newenvironment{motto}{
~\vfill
\begin{flushright}
  \eightssi \fangsong
}{\end{flushright}}

\newenvironment{note}{
\paragraph{蹄注}}{\bigskip}

\newenvironment{engnote}{
\paragraph{Hoovenote}}{\bigskip}

\newcommand\printstatus[7]{
\begin{flushleft}
\textbf{帕比的属性}
\end{flushleft}

\begin{itemize}
\item 力量：#1
\item 感知：#2
\item 耐力：#3
\item 魅力：#4
\item 智力：#5
\item 敏捷：#6
\item 幸运：#7
\end{itemize}
}

\newcommand\engprintstatus[7]{
\begin{flushleft}
\textbf{Puppy's S.P.E.C.I.A.L.}
\end{flushleft}

\begin{itemize}
\item{\makebox[2cm][l]{Strength:} #1}
\item{\makebox[2cm][l]{Perception:} #2}
\item{\makebox[2cm][l]{Endurance:} #3}
\item{\makebox[2cm][l]{Charisma:} #4}
\item{\makebox[2cm][l]{Intelligence:} #5}
\item{\makebox[2cm][l]{Agility:} #6}
\item{\makebox[2cm][l]{Luck:} #7}
\end{itemize}
}


%----------------------------------------------------------------------------------------
%	定义符号与缩写
%----------------------------------------------------------------------------------------

% 第一种样式
% \newcommand{\horizonline}{
%     \begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}
% }

% 第二种样式
% \newcommand{\horizonline}{
%     \begin{center}\includegraphics[width=0.5\linewidth]{image_line.png}\end{center}
% }

% 第三种样式 via: fancyhdr 宏包手册
\usepackage{fourier-orns}
\newcommand{\horizonline}{%
\begin{englishpar}
  \begin{center}
    \rule{0.2\linewidth}{\linethickness}
    \raisebox{-2.1pt}{\hspace{1em}\decofourleft\decotwo\decofourright\hspace{1em}}% 然而并不对称
    \rule{0.2\linewidth}{\linethickness}
  \end{center}
\end{englishpar}
}

%----------------------------------------------------------------------------------------
% 目录问题解决
%----------------------------------------------------------------------------------------

% 需要放在 hyperref 后面
% 规定 chapter 的计数器的上级为 part，使得每个 part 后 chapter 清零
% 暴力使用 setcounter{chapter}{0} 会使得 hyperref 错误
\makeatletter
\@addtoreset{chapter}{part}
\makeatother
% via: [sectioning - How to reset chapter and section counter with \part - TeX - LaTeX Stack Exchange](https://tex.stackexchange.com/questions/54383/how-to-reset-chapter-and-section-counter-with-part)




